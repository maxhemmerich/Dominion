<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Test Diagnostics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #2c3e50;
            color: white;
        }
        .test {
            background: #34495e;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .pass { border-left: 5px solid #2ecc71; }
        .fail { border-left: 5px solid #e74c3c; }
        button {
            padding: 10px 20px;
            font-size: 16px;
            margin: 10px 0;
            cursor: pointer;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover { background: #2980b9; }
        #log {
            background: #1a1a1a;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç Territory Conquest - Diagnostics</h1>

    <div id="tests"></div>

    <h2>Interactive Tests:</h2>
    <button id="testBtn">Click Me to Test Button Functionality</button>
    <button id="socketTestBtn">Test Socket Connection</button>

    <h2>Console Log:</h2>
    <div id="log"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const testsDiv = document.getElementById('tests');
        const logDiv = document.getElementById('log');

        function log(message, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#e74c3c' : type === 'success' ? '#2ecc71' : '#3498db';
            logDiv.innerHTML += `<div style="color: ${color}">[${time}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function addTest(name, result, details) {
            const div = document.createElement('div');
            div.className = `test ${result ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <strong>${result ? '‚úì' : '‚úó'} ${name}</strong>
                <div style="margin-top: 5px; font-size: 14px;">${details}</div>
            `;
            testsDiv.appendChild(div);
        }

        // Run diagnostics
        log('Starting diagnostics...');

        // Test 1: Check if DOM is loaded
        addTest('DOM Loaded', document.readyState === 'complete' || document.readyState === 'interactive',
            `Document state: ${document.readyState}`);

        // Test 2: Check if Socket.io is loaded
        const socketIOLoaded = typeof io !== 'undefined';
        addTest('Socket.io Library', socketIOLoaded,
            socketIOLoaded ? 'Socket.io is available' : 'Socket.io failed to load');

        // Test 3: Check button elements
        const testBtn = document.getElementById('testBtn');
        addTest('Button Elements', testBtn !== null,
            testBtn ? 'Buttons are accessible' : 'Cannot find button elements');

        // Test 4: Test button click
        if (testBtn) {
            testBtn.addEventListener('click', () => {
                log('‚úì Button click event works!', 'success');
                alert('Button is clickable! If you see this, JavaScript events are working.');
            });
        }

        // Test 5: Socket connection
        if (socketIOLoaded) {
            const socketTestBtn = document.getElementById('socketTestBtn');
            socketTestBtn.addEventListener('click', () => {
                log('Attempting to connect to Socket.io server...');
                const socket = io();

                socket.on('connect', () => {
                    log('‚úì Socket.io connected successfully! ID: ' + socket.id, 'success');
                    addTest('Socket.io Connection', true, `Connected with ID: ${socket.id}`);
                });

                socket.on('connect_error', (error) => {
                    log('‚úó Socket.io connection failed: ' + error.message, 'error');
                    addTest('Socket.io Connection', false, `Error: ${error.message}`);
                });

                setTimeout(() => {
                    if (!socket.connected) {
                        log('‚úó Socket.io connection timeout', 'error');
                        addTest('Socket.io Connection', false, 'Connection timeout after 5 seconds');
                    }
                }, 5000);
            });
        }

        // Test 6: Check if files are served correctly
        fetch('/shared/Territory.js')
            .then(response => {
                addTest('Game Files Loading', response.ok,
                    response.ok ? 'Game files are accessible' : `HTTP ${response.status}`);
                if (!response.ok) {
                    log(`‚úó Failed to load game files: HTTP ${response.status}`, 'error');
                }
            })
            .catch(error => {
                addTest('Game Files Loading', false, `Error: ${error.message}`);
                log('‚úó Failed to load game files: ' + error.message, 'error');
            });

        // Test 7: Check browser console for errors
        window.addEventListener('error', (e) => {
            log(`‚úó JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        log('Diagnostics complete. Check results above.');

        // Additional info
        log(`Browser: ${navigator.userAgent}`);
        log(`Page URL: ${window.location.href}`);
    </script>
</body>
</html>
